---
layout:     post
title:      卡尔曼滤波————从平均值讲起
subtitle:   卡尔曼滤波学习笔记
date:       2025-08-21
author:     BY CGH
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 卡尔曼滤波
    - 编程
---
# 前记
这是我个人在学习卡尔曼滤波过程中，对其的一点浅薄理解，一点想法。希望能为后人，作参考一二。
## 平均值
世界是嘈杂的。Kalman and Bayesian Fliter 这本书中如此说道。诚然，我们无法获得一个精确的数，世界总在和我们开名为误差的玩笑。只是误差，就好像命运石之门中时间线的收束，是有一个误差范围的。  
根据大数定理，按照正态分布在正确值两侧的误差，在全部互加后，应当等于0.  
（想象一下一堆石头，偏冷或者偏热，但是全部混一起就温度刚刚好）  
因此我们对获取的数据作平均数，也就是(x1+x2+x3+....xn)/n，理论上就可以得到完美的数据。  
你这么做了吗？那恭喜你，你获得了一个均值滤波器。当然，因为我们实际传感器是离散的，并且不可能等待收集足够多数据再取平均数。我们需要一边收集数据，一边进行平均，这样就需要一个新的公式
mean_new=(S_old+x_new)/n+1,也可以写成：  
mean_new=(mean_old*n+x_new)/(n+1),然后  
mean_new=(mean_old*n+mean_old-mean_old+x_new)/(n+1)  
=(mean_old*(n+1)-mean_old+x_new)/(n+1)  
即mean_new=mean_old+(x_new-mean_old)/(n+1)  
这样我们就得到了一个比较简洁的公式，只需要储存平均值和数字个数，再加一个新数据就足够了 
与此同时，数据会不断更新，我们要不断丢弃旧的数据，这会导致我们要加非常多次的数据
(时间复杂度O(n)，也就是指数级增长的计算量），因此我们需要让每一个新进来的家伙自己找好定位，而不是让整体去适应它。
那么我们便做点数学手段：
假设我们设置一个“窗口”，只对某个有n个数的范围内的数作平均，那么便有
S_new=S-x_old +x_new
mean_new=S_new/n
这个等价于：（S-x_old）/n+ x_new/n,也就是mean_new=mean_old+(x_new-x_old)/n
那么这便就是简单的滑动均值滤波器。  
## G-H 滤波器
我们知道，传感器是不准确的。它的读数会在一个范围内波动。但是，经验告诉我们，这个误差是在一个范围内的。假设我们一天后再称一次体重，体重秤的误差在10kg左右，获得的读数是50kg，那么我们就可以确定我们的体重至少是在40-60kg之间。假设我们再称一次体重，我们获得了51kg的读数，那么我们又可以获得一个41-61kg的范围。那么，我们的体重是增加了，还是减少，亦或者压根没变？
无从得知。我们只能判定，我们最多上升了21kg，或者下降了19kg。下面的图很好的展示了，我们在一段连续的测量中能获得的变化趋势。 


显然我们不会在一天之内变成月半（良子（恶俗））。因此，有时候一些夸张的数据是不可靠的。比如原本是50kg，因为误差漂到了60kg，这是不现实的。这时候我们根据自己的经验，可以对趋势做个估计，比如假设一天增重1kg(只是个随手举的例子)，那么30天后我们将增重30kg。这是真实可信的吗？我们不知道，但是我们“预测”如此。实际情况下，我们甚至可能体重减轻了。因此我们要使用测量取得的值作为参考。
然后我们就可以假设一个初始值x_0,然后对它以设定好的斜率预测一个步长，得到x_1，比如50（初始值）+1（步长）*1（斜率）=51（新预测值）。显然这个值不会和测量值一模一样，那么我们便将测量值和预测值做个差，得到Erro_x。（文献里一般把z和y当测量值，但是我这是菜狗小笔记）我们有多信任测量值呢？如果我们十分信任的话，我们就应该将这个差整个加到初始值中。如果我们完全不信任他，就应该直接使用预测值。如果我们半信不信呢?比如设置信任度为0.2，那么就将这个差乘以0.2，然后加到预测值上，我们就得到了“估计值”。接下来，我们再对这个估计值进行预测，然后再乘以信任度，得到新的估计值。
到这一步，我们已经初步完成了简单的G-H滤波器的框架。下面我将先给出一个相对完整的MATLAB示例代码：

g参数就是对预测的信任程度，g大则更相信预测，否则更相信读取的数据。  
h参数就是对变化的敏感程度。h大更快收敛，也更快震荡。  
而我们的卡尔曼滤波器，包括许多其他的滤波器，都在数学上等价于G-H滤波器，不过它们用特别的办法，自动管理G,H参数，以解决G-H滤波器的一些问题


## 贝叶斯公式
贝叶斯公式，大伙都很熟悉，是关于先验概率和后验概率的。这里先引入几个专有名词：
似然，先验概率，后验概率。
